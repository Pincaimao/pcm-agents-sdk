# 金牌HR大赛组件使用文档

## 概述

`pcm-hr-chat-modal` 是一个用于进行 AI 视频面试的 Web 组件，支持AI 问答、视频录制等功能。该组件可以轻松嵌入到现有网页中，实现在线面试评测功能。

最新版本

pcm-agents：0.3.5

pcm-agents-react：0.1.4

pcm-agents-vue：0.1.6

## 安装与引入

### 通过 CDN 引入

```html
<script type="module" src="https://pub.pincaimao.com/sdk/js/pcm-agents@0.3.5/dist/pcm-agents/pcm-agents.esm.js"></script>
```

```html
<pcm-hr-chat-modal 
      id="pcm-chat-modal"
      token="app...."
      modal-title="金牌HR大赛" 
      welcome-message="欢迎您参加长沙市人力资源和社会保障局组织的金牌HR大赛，接下来我们将采用数字人方式对您做交流，本次大赛预计需要10-30分钟，请在安静的环境下参与此次大赛。"
      icon="https://p3-pc.douyinpic.com/img/aweme-avatar/tos-cn-avt-0015_55cc4ce1aa0059074f4f9def520246dc~c5_300x300.jpeg"
      conversation-id=""
      to-email="790002517@qq.com"
      display-content-status="true"
      fullscreen="true"
      total-questions="10"
      enable-voice="false"
    ></pcm-hr-chat-modal>
```



### react中使用

下载并导入`pcm-agents`和`pcm-agents-react` ，具体组件传参方式参考CDN引入，这里只演示框架使用形式

```react
import './App.css';
import { PcmHrChatModal  } from 'pcm-agents-react';

function App() {
  return (
    <div className="App">
      <PcmHrChatModal 
        id="test-pcm-chat-modal"
      </PcmHrChatModal>
    </div>
  );
}

export default App;

```



### vue中使用

下载并导入`pcm-agents`和`pcm-agents-vue` ，具体组件传参方式参考CDN引入，这里只演示框架使用形式

main.ts
```js
import { defineCustomElements } from 'pcm-agents/loader';
defineCustomElements();
```



app.vue

```vue
import { PcmHrChatModal } from 'pcm-agents-vue';
<PcmHrChatModal 
 id="test-pcm-chat-modal"    
</PcmHrChatModal>
```



### vue2中使用


index.html ，具体组件传参方式参考CDN引入，这里只演示框架使用形式
```html
<script type="module" src="https://s4.zstatic.net/npm/pcm-agents@0.2.4/dist/pcm-agents/pcm-agents.esm.js"></script>
```

```vue
<PcmHrChatModal 
    id="test-pcm-chat-modal"
</PcmHrChatModal>
```





## 属性

| Property               | Attribute                | Description                                                  | Type      | Default      |
| ---------------------- | ------------------------ | ------------------------------------------------------------ | --------- | ------------ |
| `conversationId`       | `conversation-id`        | 会话ID，传入继续对话，否则创建新会话                         | `string`  | `undefined`  |
| `countdownWarningTime` | `countdown-warning-time` | 录制倒计时提醒时间（秒） 当剩余时间小于此值时，显示倒计时警告 | `number`  | `30`         |
| `defaultQuery`         | `default-query`          | 默认查询文本                                                 | `string`  | `''`         |
| `displayContentStatus` | `display-content-status` | 是否显示题干内容                                             | `boolean` | `true`       |
| `enableVoice`          | `enable-voice`           | 是否自动播放语音问题                                         | `boolean` | `true`       |
| `fullscreen`           | `fullscreen`             | 是否以全屏模式打开，移动端建议设置为true                     | `boolean` | `false`      |
| `icon`                 | `icon`                   | 应用图标URL                                                  | `string`  | `undefined`  |
| `isNeedClose`          | `is-need-close`          | 是否展示右上角的关闭按钮                                     | `boolean` | `true`       |
| `isOpen`               | `is-open`                | 是否显示聊天模态框                                           | `boolean` | `false`      |
| `isShowHeader`         | `is-show-header`         | 是否展示顶部标题栏                                           | `boolean` | `true`       |
| `maxRecordingTime`     | `max-recording-time`     | 视频录制最大时长（秒）                                       | `number`  | `120`        |
| `modalTitle`           | `modal-title`            | 模态框标题                                                   | `string`  | `'在线客服'` |
| `toEmail`              | `to-email`               | 接收报告的邮箱地址                                           | `string`  | `''`         |
| `token`                | `token`                  | SDK鉴权密钥                                                  | `string`  | `''`         |
| `totalQuestions`       | `total-questions`        | 总题目数量                                                   | `number`  | `2`          |
| `zIndex`               | `z-index`                | 聊天框的页面层级                                             | `number`  | `1000`       |



## 事件

| Event                   | Description                                    | Type                                                         |
| ----------------------- | ---------------------------------------------- | ------------------------------------------------------------ |
| `conversationStart`     | 新会话开始的回调，只会在一轮对话开始时触发一次 | `CustomEvent<{ conversation_id: string; event: string; message_id: string; id: string; }>` |
| `interviewComplete`     | 当面试完成时触发                               | `CustomEvent<{ conversation_id: string; total_questions: number; }>` |
| `modalClosed`           | 当点击模态框关闭时触发                         | `CustomEvent<void>`                                          |
| `recordingError`        | 录制错误事件                                   | `CustomEvent<{ type: string; message: string; details?: any; }>` |
| `recordingStatusChange` | 录制状态变化事件                               | `CustomEvent<{ status: "started" \| "stopped" \| "paused" \| "resumed" \| "failed"; details?: any; }>` |
| `streamComplete`        | 一轮对话结束时的回调                           | `CustomEvent<{ conversation_id: string; event: string; message_id: string; id: string; }>` |









## 完整示例

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>金牌HR大赛</title>
  <script type="module" src="https://pub.pincaimao.com/sdk/js/pcm-agents@0.3.5/dist/pcm-agents/pcm-agents.esm.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    .demo-controls {
      margin: 20px;
      padding: 20px;
      border: 1px solid #eee;
      border-radius: 8px;
    }
    button {
      padding: 8px 16px;
      background-color: #1890ff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .status {
      margin: 10px 0;
      padding: 10px;
      border-radius: 4px;
    }
    .success {
      background-color: #f6ffed;
      border: 1px solid #b7eb8f;
      color: #52c41a;
    }
    .error {
      background-color: #fff2f0;
      border: 1px solid #ffccc7;
      color: #ff4d4f;
    }
  </style>
</head>
<body>
  <div style="display: flex; justify-content: center">
    <div class="demo-controls">
      <h2>金牌HR大赛</h2>
      
      <div class="device-check">
        <button id="check-devices">检查设备权限</button>
        <div id="status-message" class="status" style="display: none;"></div>
        <div class="permission-info">
          需要检查您的摄像头和麦克风权限，以便在聊天过程中进行视频通话。
        </div>
      </div>
      
      <button id="open-chat" disabled>开始AI面试</button>
    </div>

    <pcm-hr-chat-modal 
      id="pcm-chat-modal" 
      token="app...."
      modal-title="金牌HR大赛" 
      welcome-message="欢迎您参加人力资源和社会保障局组织的金牌HR大赛，接下来我们将采用数字人方式对您做交流，本次大赛预计需要10-30分钟，请在安静的环境下参与此次大赛。"
      icon="https://example.com/icon.jpg"
      conversation-id=""
      to-email="user@example.com"
      fullscreen="true"
      total-questions="10"
      enable-voice="true"
    ></pcm-hr-chat-modal>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM 已加载，正在设置事件监听器...');
      
      // 获取元素引用
      const chatModal = document.getElementById('pcm-chat-modal');
      const openChatButton = document.getElementById('open-chat');
      const checkDevicesButton = document.getElementById('check-devices');
      const statusMessage = document.getElementById('status-message');
      
      // 检查设备和权限
      let stream = null;
      
      checkDevicesButton.addEventListener('click', async function() {
        try {
          statusMessage.style.display = 'block';
          
          // 检查浏览器支持
          if (!navigator.mediaDevices) {
            showError('您的浏览器不支持媒体设备API，请使用现代浏览器如Chrome、Firefox等');
            return;
          }
          
          // 列出可用的媒体设备
          const devices = await navigator.mediaDevices.enumerateDevices();
          const hasCamera = devices.some(device => device.kind === 'videoinput');
          const hasMicrophone = devices.some(device => device.kind === 'audioinput');
          
          if (!hasCamera) {
            showError('未检测到摄像头设备');
            return;
          }
          
          if (!hasMicrophone) {
            showError('未检测到麦克风设备');
            return;
          }
          
          // 尝试获取媒体流
          stream = await navigator.mediaDevices.getUserMedia({
            video: true,
            audio: true
          });
          
          // 更新UI状态
          showSuccess('设备和权限检查通过，可以开始聊天');
          openChatButton.disabled = false;
          
        } catch (error) {
          console.error('获取媒体设备失败:', error);
          
          if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
            showError('权限被拒绝。请在浏览器设置中允许访问摄像头和麦克风。');
          } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
            showError('找不到摄像头或麦克风设备。');
          } else if (error.name === 'NotReadableError' || error.name === 'TrackStartError') {
            showError('无法访问摄像头或麦克风，可能被其他应用程序占用。');
          } else {
            showError(`发生错误: ${error.message}`);
          }
        }
      });
      
      // 辅助函数
      function showError(message) {
        statusMessage.textContent = message;
        statusMessage.className = 'status error';
      }
      
      function showSuccess(message) {
        statusMessage.textContent = message;
        statusMessage.className = 'status success';
      }
      
      if (chatModal) {
        chatModal.addEventListener('messageSent', function(event) {
          console.log('发送消息:', event.detail);
        });
        
        chatModal.addEventListener('modalClosed', function() {
          console.log('聊天窗口已关闭');
        });

        // 添加 streamComplete 事件监听
        chatModal.addEventListener('streamComplete', function(event) {
          console.log('流式响应完成:', event.detail);
          // 更新 conversation_id
          chatModal.setAttribute('conversation-id', event.detail.conversation_id);
        });

        // 添加 interviewComplete 事件监听
        chatModal.addEventListener('interviewComplete', function(event) {
          console.log('面试完成:', event.detail);
          chatModal.isOpen = false;
          alert('非常感谢您的参与，人力资源和社会保障局将会在后续公布评选结果，如想获取您在本次金牌HR大赛中的评选报告，请联系相关负责人。');
        });
        
        // 添加录制错误事件监听
        chatModal.addEventListener('recordingError', function(event) {
          console.error('录制错误:', event.detail);
          alert('录制视频时发生错误，请刷新页面重试。');
        });
      }

      // 打开聊天按钮事件监听
      if (openChatButton && chatModal) {
        openChatButton.addEventListener('click', function() {
          chatModal.isOpen = true;
          console.log('打开聊天');
          // 停止媒体流，因为已经不需要了
          if (stream) {
            stream.getTracks().forEach(track => track.stop());
            stream = null;
          }
        });
      }
      
      // 页面关闭时停止所有媒体流
      window.addEventListener('beforeunload', () => {
        if (stream) {
          stream.getTracks().forEach(track => track.stop());
        }
      });
    });
  </script>
</body>
</html>
```



